/**
 * @license MIT
 * @fileOverview Favico animations
 * @author Miroslav Magda, http://blog.ejci.net
 * @version 0.3.1
 */
!function () {
    var e = function (e) {
        "use strict";
        function t(e) {
            if (e.paused || e.ended || y)return!1;
            try {
                c.clearRect(0, 0, s, a), c.drawImage(e, 0, 0, s, a)
            } catch (o) {
            }
            setTimeout(t, L.duration, e), E.setIcon(h)
        }

        function o(e) {
            var t = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            e = e.replace(t, function (e, t, o, n) {
                return t + t + o + o + n + n
            });
            var o = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);
            return o ? {r: parseInt(o[1], 16), g: parseInt(o[2], 16), b: parseInt(o[3], 16)} : !1
        }

        function n(e, t) {
            var o, n = {};
            for (o in e)n[o] = e[o];
            for (o in t)n[o] = t[o];
            return n
        }

        e = e ? e : {};
        var r, i, a, s, h, c, l, u, f, d, g, y, w, x = {bgColor: "#d00", textColor: "#fff", fontFamily: "sans-serif", fontStyle: "bold", type: "circle", position: "down", animation: "slide", elementId: !1};
        w = {}, w.ff = /firefox/i.test(navigator.userAgent.toLowerCase()), w.chrome = /chrome/i.test(navigator.userAgent.toLowerCase()), w.opera = /opera/i.test(navigator.userAgent.toLowerCase()), w.ie = /msie/i.test(navigator.userAgent.toLowerCase()) || /trident/i.test(navigator.userAgent.toLowerCase()), w.supported = w.chrome || w.ff || w.opera;
        var m = [];
        g = function () {
        }, u = y = !1;
        var p = function () {
            if (r = n(x, e), r.bgColor = o(r.bgColor), r.textColor = o(r.textColor), r.position = r.position.toLowerCase(), r.animation = L.types["" + r.animation] ? r.animation : x.animation, "up" === r.position)for (var t = 0; t < L.types["" + r.animation].length; t++) {
                var u = L.types["" + r.animation][t];
                u.y = u.y < .6 ? u.y - .4 : u.y - 2 * u.y + (1 - u.w), L.types["" + r.animation][t] = u
            }
            r.type = b["" + r.type] ? r.type : x.type;
            try {
                i = E.getIcon(), h = document.createElement("canvas"), l = document.createElement("img"), i.hasAttribute("href") ? (l.setAttribute("src", i.getAttribute("href")), l.onload = function () {
                    a = l.height > 0 ? l.height : 32, s = l.width > 0 ? l.width : 32, h.height = a, h.width = s, c = h.getContext("2d"), v.ready()
                }) : (l.setAttribute("src", ""), a = 32, s = 32, l.height = a, l.width = s, h.height = a, h.width = s, c = h.getContext("2d"), v.ready())
            } catch (f) {
                throw"Error initializing favico. Message: " + f.message
            }
        }, v = {};
        v.ready = function () {
            u = !0, v.reset(), g()
        }, v.reset = function () {
            m = [], f = !1, c.clearRect(0, 0, s, a), c.drawImage(l, 0, 0, s, a), E.setIcon(h)
        }, v.start = function () {
            if (u && !d) {
                var e = function () {
                    f = m[0], d = !1, m.length > 0 && (m.shift(), v.start())
                };
                m.length > 0 && (d = !0, f ? L.run(f.options, function () {
                    L.run(m[0].options, function () {
                        e()
                    }, !1)
                }, !0) : L.run(m[0].options, function () {
                    e()
                }, !1))
            }
        };
        var b = {}, C = function (e) {
            return e.n = Math.abs(e.n), e.x = s * e.x, e.y = a * e.y, e.w = s * e.w, e.h = a * e.h, e
        };
        b.circle = function (e) {
            e = C(e);
            var t = e.n > 9 && e.n < 100;
            t && (e.x = e.x - .4 * e.w, e.w = 1.4 * e.w), c.clearRect(0, 0, s, a), c.drawImage(l, 0, 0, s, a), c.beginPath(), c.font = r.fontStyle + " " + Math.floor(e.h) + "px " + r.fontFamily, c.textAlign = "center", t ? (c.moveTo(e.x + e.w / 2, e.y), c.lineTo(e.x + e.w - e.h / 2, e.y), c.quadraticCurveTo(e.x + e.w, e.y, e.x + e.w, e.y + e.h / 2), c.lineTo(e.x + e.w, e.y + e.h - e.h / 2), c.quadraticCurveTo(e.x + e.w, e.y + e.h, e.x + e.w - e.h / 2, e.y + e.h), c.lineTo(e.x + e.h / 2, e.y + e.h), c.quadraticCurveTo(e.x, e.y + e.h, e.x, e.y + e.h - e.h / 2), c.lineTo(e.x, e.y + e.h / 2), c.quadraticCurveTo(e.x, e.y, e.x + e.h / 2, e.y)) : c.arc(e.x + e.w / 2, e.y + e.h / 2, e.h / 2, 0, 2 * Math.PI), c.fillStyle = "rgba(" + r.bgColor.r + "," + r.bgColor.g + "," + r.bgColor.b + "," + e.o + ")", c.fill(), c.closePath(), c.beginPath(), c.stroke(), c.fillStyle = "rgba(" + r.textColor.r + "," + r.textColor.g + "," + r.textColor.b + "," + e.o + ")", e.n > 99 ? c.fillText("∞", Math.floor(e.x + e.w / 2), Math.floor(e.y + e.h - .15 * e.h)) : c.fillText(e.n, Math.floor(e.x + e.w / 2), Math.floor(e.y + e.h - .15 * e.h)), c.closePath()
        }, b.rectangle = function (e) {
            e = C(e);
            var t = e.n > 9 && e.n < 100;
            t && (e.x = Math.floor(e.x - .4 * e.w), e.w = Math.floor(1.4 * e.w)), c.clearRect(0, 0, s, a), c.drawImage(l, 0, 0, s, a), c.beginPath(), c.font = "bold " + Math.floor(e.h) + "px sans-serif", c.textAlign = "center", c.fillStyle = "rgba(" + r.bgColor.r + "," + r.bgColor.g + "," + r.bgColor.b + "," + e.o + ")", c.fillRect(e.x, e.y, e.w, e.h), c.fillStyle = "rgba(" + r.textColor.r + "," + r.textColor.g + "," + r.textColor.b + "," + e.o + ")", e.n > 99 ? c.fillText("∞", Math.floor(e.x + e.w / 2), Math.floor(e.y + e.h - .15 * e.h)) : c.fillText(e.n, Math.floor(e.x + e.w / 2), Math.floor(e.y + e.h - .15 * e.h)), c.closePath()
        };
        var M = function (e, t) {
            g = function () {
                try {
                    if (e > 0) {
                        if (L.types["" + t] && (r.animation = t), m.push({type: "badge", options: {n: e}}), m.length > 100)throw"Too many badges requests in queue.";
                        v.start()
                    } else v.reset()
                } catch (o) {
                    throw"Error setting badge. Message: " + o.message
                }
            }, u && g()
        }, A = function (e) {
            g = function () {
                try {
                    var t = e.width, o = e.height, n = document.createElement("img"), r = o / a > t / s ? t / s : o / a;
                    n.setAttribute("src", e.getAttribute("src")), n.height = o / r, n.width = t / r, c.clearRect(0, 0, s, a), c.drawImage(n, 0, 0, s, a), E.setIcon(h)
                } catch (i) {
                    throw"Error setting image. Message: " + i.message
                }
            }, u && g()
        }, I = function (e) {
            g = function () {
                try {
                    if ("stop" === e)return y = !0, v.reset(), y = !1, void 0;
                    e.addEventListener("play", function () {
                        t(this)
                    }, !1)
                } catch (o) {
                    throw"Error setting video. Message: " + o.message
                }
            }, u && g()
        }, T = function (e) {
            if (window.URL && window.URL.createObjectURL || (window.URL = window.URL || {}, window.URL.createObjectURL = function (e) {
                return e
            }), w.supported) {
                var o = !1;
                navigator.getUserMedia = navigator.getUserMedia || navigator.oGetUserMedia || navigator.msGetUserMedia || navigator.mozGetUserMedia || navigator.webkitGetUserMedia, g = function () {
                    try {
                        if ("stop" === e)return y = !0, v.reset(), y = !1, void 0;
                        o = document.createElement("video"), o.width = s, o.height = a, navigator.getUserMedia({video: !0, audio: !1}, function (e) {
                            o.src = URL.createObjectURL(e), o.play(), t(o)
                        }, function () {
                        })
                    } catch (n) {
                        throw"Error setting webcam. Message: " + n.message
                    }
                }, u && g()
            }
        }, E = {};
        E.getIcon = function () {
            var e = !1, t = function () {
                for (var e = document.getElementsByTagName("head")[0].getElementsByTagName("link"), t = e.length, o = t - 1; o >= 0; o--)if (/icon/i.test(e[o].getAttribute("rel")))return e[o];
                return!1
            };
            return r.elementId ? (e = document.getElementById(r.elementId), e.setAttribute("href", e.getAttribute("src"))) : (e = t(), e === !1 && (e = document.createElement("link"), e.setAttribute("rel", "icon"), document.getElementsByTagName("head")[0].appendChild(e))), e.setAttribute("type", "image/png"), e
        }, E.setIcon = function (e) {
            var t = e.toDataURL("image/png");
            if (r.elementId)document.getElementById(r.elementId).setAttribute("src", t); else if (w.ff || w.opera) {
                var o = i;
                i = document.createElement("link"), w.opera && i.setAttribute("rel", "icon"), i.setAttribute("rel", "icon"), i.setAttribute("type", "image/png"), document.getElementsByTagName("head")[0].appendChild(i), i.setAttribute("href", t), o.parentNode && o.parentNode.removeChild(o)
            } else i.setAttribute("href", t)
        };
        var L = {};
        return L.duration = 40, L.types = {}, L.types.fade = [
            {x: .4, y: .4, w: .6, h: .6, o: 0},
            {x: .4, y: .4, w: .6, h: .6, o: .1},
            {x: .4, y: .4, w: .6, h: .6, o: .2},
            {x: .4, y: .4, w: .6, h: .6, o: .3},
            {x: .4, y: .4, w: .6, h: .6, o: .4},
            {x: .4, y: .4, w: .6, h: .6, o: .5},
            {x: .4, y: .4, w: .6, h: .6, o: .6},
            {x: .4, y: .4, w: .6, h: .6, o: .7},
            {x: .4, y: .4, w: .6, h: .6, o: .8},
            {x: .4, y: .4, w: .6, h: .6, o: .9},
            {x: .4, y: .4, w: .6, h: .6, o: 1}
        ], L.types.none = [
            {x: .4, y: .4, w: .6, h: .6, o: 1}
        ], L.types.pop = [
            {x: 1, y: 1, w: 0, h: 0, o: 1},
            {x: .9, y: .9, w: .1, h: .1, o: 1},
            {x: .8, y: .8, w: .2, h: .2, o: 1},
            {x: .7, y: .7, w: .3, h: .3, o: 1},
            {x: .6, y: .6, w: .4, h: .4, o: 1},
            {x: .5, y: .5, w: .5, h: .5, o: 1},
            {x: .4, y: .4, w: .6, h: .6, o: 1}
        ], L.types.popFade = [
            {x: .75, y: .75, w: 0, h: 0, o: 0},
            {x: .65, y: .65, w: .1, h: .1, o: .2},
            {x: .6, y: .6, w: .2, h: .2, o: .4},
            {x: .55, y: .55, w: .3, h: .3, o: .6},
            {x: .5, y: .5, w: .4, h: .4, o: .8},
            {x: .45, y: .45, w: .5, h: .5, o: .9},
            {x: .4, y: .4, w: .6, h: .6, o: 1}
        ], L.types.slide = [
            {x: .4, y: 1, w: .6, h: .6, o: 1},
            {x: .4, y: .9, w: .6, h: .6, o: 1},
            {x: .4, y: .9, w: .6, h: .6, o: 1},
            {x: .4, y: .8, w: .6, h: .6, o: 1},
            {x: .4, y: .7, w: .6, h: .6, o: 1},
            {x: .4, y: .6, w: .6, h: .6, o: 1},
            {x: .4, y: .5, w: .6, h: .6, o: 1},
            {x: .4, y: .4, w: .6, h: .6, o: 1}
        ], L.run = function (e, t, o, i) {
            var a = L.types[r.animation];
            return i = o === !0 ? "undefined" != typeof i ? i : a.length - 1 : "undefined" != typeof i ? i : 0, t = t ? t : function () {
            }, i < a.length && i >= 0 ? (b[r.type](n(e, a[i])), setTimeout(function () {
                o ? i -= 1 : i += 1, L.run(e, t, o, i)
            }, L.duration), E.setIcon(h), void 0) : (t(), void 0)
        }, p(), {badge: M, video: I, image: A, webcam: T, reset: v.reset}
    };
    "undefined" != typeof define && define.amd ? define([], function () {
        return e
    }) : "undefined" != typeof module && module.exports ? module.exports = e : this.Favico = e
}();